---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const dateFormatter = new Intl.DateTimeFormat('fr-FR', { dateStyle: 'long' });

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => data.published && !data.draft);

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const { title, description, pubDate, tags } = post.data;
---
<BaseLayout title={title} description={description} lang="fr" currentPath={Astro.url.pathname}>
  <article class="space-y-6 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-cyan-500/10">
    <div class="flex flex-wrap items-center gap-3 text-sm text-slate-400">
      <span class="rounded-full bg-white/5 px-3 py-1 font-semibold text-slate-200">
        {dateFormatter.format(pubDate)}
      </span>
      {tags.map((tag) => (
        <span class="rounded-full bg-cyan-500/15 px-2 py-1 text-xs font-semibold text-cyan-100 ring-1 ring-cyan-500/30">
          {tag}
        </span>
      ))}
    </div>

    <div class="space-y-3">
      <h1 class="text-3xl font-bold text-white sm:text-4xl">{title}</h1>
      <p class="text-lg text-slate-200">{description}</p>
    </div>

    <div class="rich-text space-y-6 leading-relaxed text-slate-200">
      <Content />
    </div>

    <div class="pt-4">
      <a class="text-sm font-semibold text-cyan-200 underline decoration-cyan-500/60 underline-offset-4 hover:text-white" href="/blog">
        ‚Üê Retour au blog
      </a>
    </div>
  </article>
</BaseLayout>

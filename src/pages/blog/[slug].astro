---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { tagClasses, tagHref } from '../../utils/tags';

const dateFormatter = new Intl.DateTimeFormat('fr-FR', { dateStyle: 'long' });

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => data.published && !data.draft);

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const { title, description, pubDate, tags } = post.data;
---
<BaseLayout title={title} description={description} lang="fr" currentPath={Astro.url.pathname}>
  <article class="card-surface space-y-6 p-6">
    <div class="flex flex-wrap items-center gap-3 text-sm text-foreground/70 dark:text-foreground-dark/70">
      <span class="rounded-full bg-foreground/5 px-3 py-1 font-semibold text-foreground dark:bg-background-dark/70 dark:text-foreground-dark">
        {dateFormatter.format(pubDate)}
      </span>
      {tags.map((tag) => (
        <a class={tagClasses(tag)} href={tagHref(tag)}>
          {tag}
        </a>
      ))}
    </div>

    <div class="space-y-3">
      <h1 class="text-3xl font-bold sm:text-4xl">{title}</h1>
      <p class="text-lg text-foreground/80 dark:text-foreground-dark/75">{description}</p>
    </div>

    <div class="rich-text space-y-6 leading-relaxed">
      <Content />
    </div>

    <div class="pt-4">
      <a class="text-sm font-semibold text-primary underline decoration-primary/60 underline-offset-4 hover:text-primary/80 dark:text-primary-dark" href="/blog">
        ‚Üê Retour au blog
      </a>
    </div>
  </article>
</BaseLayout>
